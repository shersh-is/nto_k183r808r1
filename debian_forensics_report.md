# Отчет от k183r808r1. Сервачок на Дебиан

Дан образ файловой системы. Монтируем его в свою основную систему, после чего благодаря команде `sudo chroot . /bin/bash` можем исполнять команды в этой файловой системе.

### 1. Какой сервис на данном сервере уязвим? Какая версия?

Прочитав файл `/etc/passwd` видим, что есть пользователи `git`, `gitlab-www` и так далее. Из этого делаем вывод, что на сервере установлен `gitlab`, также, по файлам в системе, определяем что версия - `4.16.1`. Эта версия уязвима к уязвимости `CVE-2024-0402`.

### 2. Какой тип уязвимости использовал злоумышленник?

`CVE-2024-0402` - RCE.

### 3. Какие ошибки были допущены при конфигурации сервера?

Читаем файл `/etc/sudoers`, и видим разрешения для пользователя `git` использовать команду `git` с привилегиями суперпользователя (`sudo`).

![image](https://github.com/shersh-is/nto_k183r808r1/assets/81306107/88d3d268-11ef-4a64-bc20-034c066b6faf)

Это приводит к повышению привилегий.

### 4. Как злоумышленник повысил привилегии?

Заходим на GTFOBins, и берем пейлоад для повышения привилегий через `sudo` и `git`:

![image](https://github.com/shersh-is/nto_k183r808r1/assets/81306107/7b10919a-8e03-4a6e-99cc-1ec908650851)

### 5. Как злоумышленник получил доступ к серверу на постоянной основе?

Заходя в каталог `/root`, можно увидеть скрытые файлы: пустой файл `.pwned` (который оставил сам злоумышленник, как видно по истории команд), и директорию `.ssh`. В ней лежит ключ для `amongus@debian`, а значит злоумышленник для постоянного доступа, повысив привилегии, добавил свой ключ ssh в авторизованные, и может подключаться к машине в любой момент:

![image](https://github.com/shersh-is/nto_k183r808r1/assets/81306107/91d8647f-e01f-478f-8a18-1cdc2fab48f1)

### 6. Как злоумышленник просканировал систему?

Просмотрев history исполнения команд в файловой системе видим строчку: `rm -rf /tmp/linpeas.txt`. Значит, для сканирования системы злоумышленнеик использовал скрипт `linpeas.sh`. 

![image](https://github.com/shersh-is/nto_k183r808r1/assets/81306107/0883743d-f784-406f-9d1a-0d88d1bc3e39)

### 7. С помощью какого ВПО злоумышленник закрепился на сервере?
По истории команд видим, что злоумышленник после получения прав рут пользователя, запускал скрипт `./autokitter.sh`. Прочитав его, видим какие то данные в base64, которые расшифровываются и записываются в файлы с кодом. 

![image](https://github.com/shersh-is/nto_k183r808r1/assets/81306107/1ecbbf9f-ddc3-420b-8417-1e6b6db8e2e9)

Переведя их в чистый текст, и поискав части этого кода в интернете, натыкаемся на репозиторий с утилитой `Jynx-Kit`.
